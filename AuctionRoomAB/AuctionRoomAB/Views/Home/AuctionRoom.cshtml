@model AuctionRoomAB.Models.Item
@{
    ViewBag.Title = "Live Auction";

    if (!Request.IsAuthenticated)
    {
        Response.Redirect("/Account/Login/");
    }
}

<h2>Live Auction</h2>

<div class="container">
    <div class="row">
        <div class="col-md-5 bid-item">
            <h3>@Model.Title</h3>

            <div>
                <img class="lot_figure_image" src="/Content/images/@Model.Image" alt="@Model.Title">
                <div class="credit">Image Credit: Auctionata</div>
            </div>
            <br />
            <span>
                <div id="bid-button-container" class="btn-custom">
                </div>
                <div class="callnow">Call Auction Room <strong>+491231231231</strong></div>
            </span>
        </div>
        <div class="col-md-1">&nbsp;</div>
        <div class="col-md-4 jumbotron">
            <h3>&nbsp; More Info</h3>
            <ul>
                @Html.Raw(HttpUtility.HtmlDecode(Model.Description))
            </ul>

        </div>
    </div>
</div>

@section Styles {
    <link href="@Url.Content("/Content/auctionroom.css")" rel="stylesheet" type="text/css" />
}

@section Scripts {
    <script src="/Scripts/jquery.signalR-2.2.0.min.js"></script>

    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>

    <script>
        $(function () {
            var auction = $.connection.auctionRoomHub;

            // Called by the server to make updates
            auction.client.updateBidButton = function (message, highest) {
                var buttonVal = '<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>&nbsp;&nbsp; Bid now &nbsp; &#8364; ' + message;
                var statusClass;
                var noFurtherBids;

                if (highest) {
                    buttonVal = message;
                    statusClass = 'btn-success';
                    noFurtherBids = "disabled";
                }

                var buttonHtml = '<button type="button" id="bid-button" class="btn btn-primary btn-lg btn-wd ' + statusClass + '" ' + noFurtherBids + '>';
                buttonHtml += buttonVal;
                buttonHtml += '</button>';

                $('#bid-button-container').html(buttonHtml);
            }


            // Make call to server on bid
            $.connection.hub.start().done(function () {

                // On page load, init(gets highest mesage or current price)
                auction.server.init();

                $(document).on('click', '#bid-button', (function () {
                    auction.server.bid();
                }));
            });
        })
    </script>
}